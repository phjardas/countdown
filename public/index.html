<!doctype html>
<meta charset="utf-8">
<title>Countdown</title>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  --color: #444;
  --muted: #ccc;
  --bg: white;
}

body {
  color: var(--color);
  background: var(--bg);
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
}

.page {
  margin: 2rem;
}

#preview {
  margin-top: 2rem;
  width: 100%;
  height: 600px;
}
</style>

<div class="page">
  <h1>Countdown</h1>
  <form id="form">
    <p>
      <label for="l">Title:</label>
      <input id="l" maxlength="50" required autofocus value="Test">
    </p>
    <p>
      <label for="t">Target date:</label>
      <input type="date" id="t" required value="2021-04-19">
    </p>
    <p>
      <label for="i">Icon:</label>
      <select id="i" required value="h">
        <option value="h">Heart</option>
      </select>
    </p>
  </form>
  <iframe id="preview"></iframe>
</div>

<script>
  const now = new Date().toISOString().substring(0, 10);
  document.getElementById('t').min = now;

  const params = {};
  const preview = document.getElementById('preview');

  ['l','t','i'].forEach(id => {
    const el = document.getElementById(id);
    params[id] = el.value;
    el.addEventListener('change', e => {
      params[id] = e.target.value;
      update();
    });
  });

  document.getElementById('form').addEventListener('submit', e => {
    e.preventDefault();
    update();
  })

  function update() {
    preview.src = `/s/${btoa(JSON.stringify(params))}`;
  }

  update();
</script>
