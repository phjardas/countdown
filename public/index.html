<!doctype html>
<meta charset="utf-8">
<title>Countdown</title>
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html, body {
  height: 100%;
}

html {
  --color: #444;
  --muted: #ccc;
  --bg: white;
}

body {
  color: var(--color);
  background: var(--bg);
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
  line-height: 1.5;
  padding: 2rem;
  display: grid;
  gap: 1rem;
  grid-template-rows: auto auto auto 1fr;
}

h1 {
  color: #999;
  font-weight: normal;
  text-transform: uppercase;
  letter-spacing: 1px;
}

#form {
  display: grid;
  gap: .5rem 1rem;
  grid-template-columns: auto 1fr;
}

#preview {
  width: 100%;
  height: 100%;
}
</style>

<h1>Countdown</h1>
<form id="form">
  <label for="l">Title:</label>
  <input id="l" maxlength="50" required autofocus>
  <label for="t">Target date:</label>
  <input type="date" id="t" required>
  <label for="i">Icon:</label>
  <select id="i" required value="h">
    <option value="h">Heart</option>
    <option value="s">Star</option>
  </select>
  <label for="p">Primary color:</label>
  <input type="color" id="p" required value="#ff0000">
</form>
<p>Link: <a id="url"></a></p>
<iframe id="preview"></iframe>

<script>
  const now = new Date().toISOString().substring(0, 10);
  document.getElementById('t').min = now;

  const params = {};
  const preview = document.getElementById('preview');
  const a = document.getElementById('url');

  ['l','t','i','p'].forEach(id => {
    const el = document.getElementById(id);
    params[id] = el.value;
    el.addEventListener('change', e => {
      params[id] = e.target.value;
      update();
    });
  });

  document.getElementById('form').addEventListener('submit', e => {
    e.preventDefault();
    update();
  })

  function update() {
    const ps = { ...params, p: params.p.substring(1) }
    if (ps.t && ps.l) {
      const s = btoa(JSON.stringify(ps)).replace(/\+/g,'-').replace(/\//g,'_').replace(/=/g,'');
      const url = `${location.origin.replace(/:(80|443)$/,'')}/r/${s}/`;
      a.href = url;
      a.innerHTML = url;
      preview.src = url;
    }
  }

  update();
</script>
